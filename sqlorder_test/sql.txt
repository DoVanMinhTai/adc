-- This script was generated by a beta version of the ERD tool in pgAdmin 4.
-- Please log an issue at https://redmine.postgresql.org/projects/pgadmin4/issues/new if you find any bugs, including reproduction steps.
BEGIN;


CREATE TABLE IF NOT EXISTS public.checkout
(
    id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1 ),
    state character varying(255) COLLATE pg_catalog."default",
    customer_id character varying(255) COLLATE pg_catalog."default",
    email character varying(255) COLLATE pg_catalog."default",
    note character varying(255) COLLATE pg_catalog."default",
    payment_method_id character varying(255) COLLATE pg_catalog."default",
    promotion_code character varying(255) COLLATE pg_catalog."default",
    shipment_method_id character varying(255) COLLATE pg_catalog."default",
    shipping_address_id bigint,
    total_amount numeric(38, 2),
    total_discount_amount numeric(38, 2),
    total_shipment_fee numeric(38, 2),
    CONSTRAINT checkout_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.checkout_item
(
    id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1 ),
    description character varying(255) COLLATE pg_catalog."default",
    discount_amount numeric(38, 2),
    product_id bigint,
    product_name character varying(255) COLLATE pg_catalog."default",
    product_price numeric(38, 2),
    quantity integer NOT NULL,
    checkout_id bigint NOT NULL,
    CONSTRAINT checkout_item_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.order_address
(
    id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1 ),
    CONSTRAINT order_address_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.order_item
(
    id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1 ),
    discount_amount numeric(38, 2),
    description character varying(255) COLLATE pg_catalog."default",
    order_id bigint,
    product_id bigint,
    name character varying(255) COLLATE pg_catalog."default",
    price numeric(38, 2),
    quantity integer NOT NULL,
    shipment_fee numeric(38, 2),
    status character varying(255) COLLATE pg_catalog."default",
    tax_amount numeric(38, 2),
    tax_percent numeric(38, 2),
    CONSTRAINT order_item_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.orders
(
    id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1 ),
    attributes jsonb,
    checkout_id character varying(255) COLLATE pg_catalog."default",
    promotion_code character varying(255) COLLATE pg_catalog."default",
    customer_id character varying(255) COLLATE pg_catalog."default",
    total_shipment_fee numeric(38, 2),
    shipment_method_id character varying(255) COLLATE pg_catalog."default",
    shipment_status character varying(255) COLLATE pg_catalog."default",
    total_discount_amount real,
    email character varying(255) COLLATE pg_catalog."default",
    last_error jsonb,
    note character varying(255) COLLATE pg_catalog."default",
    number_item integer NOT NULL,
    status character varying(255) COLLATE pg_catalog."default",
    payment_id bigint,
    payment_method_id character varying(255) COLLATE pg_catalog."default",
    payment_status character varying(255) COLLATE pg_catalog."default",
    progress character varying(255) COLLATE pg_catalog."default",
    reject_reason character varying(255) COLLATE pg_catalog."default",
    total_tax real,
    total_amount numeric(38, 2),
    total_shipment_tax numeric(38, 2),
    billing_address_id bigint,
    shipping_address_id bigint,
    CONSTRAINT order_pkey PRIMARY KEY (id),
    CONSTRAINT uk8tnb5iuyyghjijqk1pi5iobeh UNIQUE (shipping_address_id),
    CONSTRAINT ukiogt57a34ijpebera2xbdv04y UNIQUE (billing_address_id)
);

ALTER TABLE IF EXISTS public.checkout_item
    ADD CONSTRAINT fk3s3vgaf23cmakh2w8bn7y6st3 FOREIGN KEY (checkout_id)
    REFERENCES public.checkout (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.order_item
    ADD CONSTRAINT fks234mi6jususbx4b37k44cipy FOREIGN KEY (order_id)
    REFERENCES public.orders (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.orders
    ADD CONSTRAINT fk1dt82cg77xa5jqxyrsu5cyq26 FOREIGN KEY (billing_address_id)
    REFERENCES public.order_address (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;
CREATE INDEX IF NOT EXISTS ukiogt57a34ijpebera2xbdv04y
    ON public.orders(billing_address_id);


ALTER TABLE IF EXISTS public.orders
    ADD CONSTRAINT fkgrdajv7n8cklh0n1x45txqb3i FOREIGN KEY (shipping_address_id)
    REFERENCES public.order_address (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;
CREATE INDEX IF NOT EXISTS uk8tnb5iuyyghjijqk1pi5iobeh
    ON public.orders(shipping_address_id);

END;